(function(_0x185128,_0x482c81){const _0x1880ce=a7_0x1f57,_0x20fd43=_0x185128();while(!![]){try{const _0x4d5d99=-parseInt(_0x1880ce(0xdf))/0x1*(-parseInt(_0x1880ce(0x7d))/0x2)+-parseInt(_0x1880ce(0x76))/0x3+-parseInt(_0x1880ce(0xcf))/0x4+-parseInt(_0x1880ce(0xde))/0x5*(parseInt(_0x1880ce(0x77))/0x6)+-parseInt(_0x1880ce(0x8c))/0x7+-parseInt(_0x1880ce(0x84))/0x8+-parseInt(_0x1880ce(0xdd))/0x9*(-parseInt(_0x1880ce(0x99))/0xa);if(_0x4d5d99===_0x482c81)break;else _0x20fd43['push'](_0x20fd43['shift']());}catch(_0x45ce62){_0x20fd43['push'](_0x20fd43['shift']());}}}(a7_0x4a9c,0x8810d));function a7_0x4a9c(){const _0x1ebaf5=['1600302mXwmwL','821622kKgnkP','contains','status','POST','quizPlaceholder','onclick','4zKWQZL','Failed\x20to\x20fetch\x20sites:\x20','w-full\x20py-2.5\x20rounded-xl\x20text-sm\x20font-bold\x20text-gray-500\x20hover:bg-gray-100\x20transition-all','visitedSites','w-full\x20text-left\x20p-2\x20rounded\x20border\x20hover:bg-gray-200\x20transition\x20text-sm','siteModal','<div\x20class=\x22marker-pin\x20','7912840EuhkrU','classList','#4F46E5','siteModalQuizResult','warn','No\x20session\x20token\x20found,\x20sites\x20will\x20not\x20load.','siteModalCheckInBtn','getElement','3831261mZuEqb','forEach','tabMustVisit','#10B981','skeleton-loading','must_visit','polygon','tabRecommended','https://placehold.co/100x100/eee/ccc?text=Site','preview-card-opening','map','application/json','custom-div-icon','8150060qnKaDl','opacity-50','innerHTML','click','tileLayer','currentModalSite','previewImage','previewCard','stringify','setView','Failed\x20to\x20load\x20site\x20data:','divIcon','className','siteModalMoreContent','game','More\x20info','error','name','createElement','text-sm\x20mt-2\x20text-center\x20font-bold\x20text-red-600','filter','VISITED_POLYGON_COLOR','siteModalMoreBtn','add','hasLayer','allPolygons','json','setStyle','siteModalQuizQ','main','appendChild','textContent','image','discovery','includes','token','coordinates','visited','clearLayers','jejak_session','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','allMarkers','siteModalInfo','remove','quiz','flyer_text','sites','addTo','https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png','siteModalQuizArea','preview-card-closing','allSiteData','siteModalImage','marker','2087040hsGnAd','currentModalMarker','w-full\x20py-2.5\x20rounded-xl\x20text-sm\x20font-bold\x20text-white\x20bg-indigo-600\x20shadow-md\x20transition-all','src','/api/get-sites','info','markersLayer','text-sm\x20mt-2\x20text-center\x20font-bold\x20text-green-600','button','mainSites','hidden','layerGroup','onload','siteModalQuizOptions','36XPokQY','15WBGQcm','149867ewTWYp','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','polygonsLayer'];a7_0x4a9c=function(){return _0x1ebaf5;};return a7_0x4a9c();}import{DEFAULT_CENTER,ZOOM,POLYGON_OPACITY,ZOOM_THRESHOLD}from'./config.js';import{state,updateState}from'./state.js';import{dom}from'./dom.js';import{animateOpenModal,openModalState}from'./ui.js';import{openGoogleMaps,hashString}from'./utils.js';import{STRINGS}from'./localization.js';export async function initializeGameAndMap(){const _0x2f565b=a7_0x1f57;if(state[_0x2f565b(0x96)])return;state[_0x2f565b(0x96)]=L[_0x2f565b(0x96)](_0x2f565b(0x96),{'zoomControl':![],'attributionControl':![]})[_0x2f565b(0xa2)](DEFAULT_CENTER,ZOOM),L[_0x2f565b(0x9d)](_0x2f565b(0xc9),{'maxZoom':0x14})['addTo'](state[_0x2f565b(0x96)]),state[_0x2f565b(0xd5)]=L[_0x2f565b(0xda)]()['addTo'](state['map']),state[_0x2f565b(0x75)]=L[_0x2f565b(0xda)]()[_0x2f565b(0xc8)](state[_0x2f565b(0x96)]),await loadSiteData();}async function loadSiteData(){const _0x5af489=a7_0x1f57;try{const _0x2c6d3d=JSON['parse'](localStorage['getItem'](_0x5af489(0xc0))),_0x9c0a49=_0x2c6d3d?.[_0x5af489(0xbc)];if(!_0x9c0a49){console[_0x5af489(0x88)](_0x5af489(0x89));return;}const _0x1cc9f6=await fetch(_0x5af489(0xd3),{'method':_0x5af489(0x7a),'headers':{'Content-Type':_0x5af489(0x97),'X-Session-Token':_0x9c0a49},'body':JSON[_0x5af489(0xa1)]({'token':_0x9c0a49})});if(!_0x1cc9f6['ok'])throw new Error(_0x5af489(0x7e)+_0x1cc9f6[_0x5af489(0x79)]);const _0x19ebbe=await _0x1cc9f6[_0x5af489(0xb3)]();updateState(_0x5af489(0xcc),_0x19ebbe[_0x5af489(0xc7)]);const _0x55b0de=_0x19ebbe[_0x5af489(0xc7)][_0x5af489(0xad)](_0x288ca9=>!isNaN(parseInt(_0x288ca9['id'])))[_0x5af489(0x96)](_0x3b8228=>_0x3b8228['id']);updateState(_0x5af489(0xd8),_0x55b0de),renderMarkers();}catch(_0xb1e4a3){console[_0x5af489(0xa9)](_0x5af489(0xa3),_0xb1e4a3);}}export function renderMarkers(){const _0x5db69b=a7_0x1f57;if(!state[_0x5db69b(0xd5)]||!state['allSiteData'])return;state[_0x5db69b(0xd5)][_0x5db69b(0xbf)](),state[_0x5db69b(0x75)]['clearLayers'](),state['allSiteData'][_0x5db69b(0x8d)](_0x2d5991=>{const _0x3d398b=_0x5db69b,_0x4869ad=state[_0x3d398b(0x80)][_0x3d398b(0xbb)](_0x2d5991['id']),_0x2988f1=state[_0x3d398b(0xd8)][_0x3d398b(0xbb)](_0x2d5991['id']),_0x373bc5=L[_0x3d398b(0xa4)]({'className':_0x3d398b(0x98),'html':_0x3d398b(0x83)+(_0x4869ad?_0x3d398b(0xbe):_0x2988f1?_0x3d398b(0xb6):_0x3d398b(0xba))+_0x3d398b(0x74)+(_0x2988f1?_0x2d5991['id']:'ðŸ”')+_0x3d398b(0xc1),'iconSize':[0x1e,0x2a],'iconAnchor':[0xf,0x2a]}),_0x2d99e2=L[_0x3d398b(0xce)](_0x2d5991[_0x3d398b(0xbd)][_0x3d398b(0xce)],{'icon':_0x373bc5})[_0x3d398b(0xc8)](state[_0x3d398b(0xd5)])['on'](_0x3d398b(0x9c),()=>handleMarkerClick(_0x2d5991,_0x2d99e2));state[_0x3d398b(0xc2)][_0x2d5991['id']]=_0x2d99e2;if(_0x2d5991[_0x3d398b(0xbd)][_0x3d398b(0x92)]){const _0x254a97=L[_0x3d398b(0x92)](_0x2d5991['coordinates'][_0x3d398b(0x92)],{'color':_0x4869ad?state[_0x3d398b(0xae)]:_0x2988f1?_0x3d398b(0x86):_0x3d398b(0x8f),'fillOpacity':POLYGON_OPACITY,'weight':0x2})[_0x3d398b(0xc8)](state[_0x3d398b(0x75)]);state['allPolygons'][_0x2d5991['id']]=_0x254a97;}}),updateMapVisibility(),state[_0x5db69b(0x96)]['on']('zoomend',updateMapVisibility);}export function filterMarkers(_0x56ac0f){const _0x1d30b6=a7_0x1f57;if(!state[_0x1d30b6(0xd5)]||!state[_0x1d30b6(0xcc)])return;state[_0x1d30b6(0xcc)][_0x1d30b6(0x8d)](_0x454758=>{const _0x2102b0=_0x1d30b6,_0x3ea43e=state[_0x2102b0(0xc2)][_0x454758['id']],_0x45c1b3=state[_0x2102b0(0xb2)][_0x454758['id']],_0x328556=state['mainSites'][_0x2102b0(0xbb)](_0x454758['id']);if(_0x56ac0f==='must_visit'){if(_0x328556){if(_0x3ea43e&&!state['markersLayer']['hasLayer'](_0x3ea43e))_0x3ea43e[_0x2102b0(0xc8)](state['markersLayer']);if(_0x45c1b3&&!state[_0x2102b0(0x75)][_0x2102b0(0xb1)](_0x45c1b3))_0x45c1b3[_0x2102b0(0xc8)](state['polygonsLayer']);}else{if(_0x3ea43e)_0x3ea43e[_0x2102b0(0xc4)]();if(_0x45c1b3)_0x45c1b3['remove']();}}else{if(_0x3ea43e&&!state['markersLayer'][_0x2102b0(0xb1)](_0x3ea43e))_0x3ea43e[_0x2102b0(0xc8)](state['markersLayer']);if(_0x45c1b3&&!state[_0x2102b0(0x75)][_0x2102b0(0xb1)](_0x45c1b3))_0x45c1b3[_0x2102b0(0xc8)](state[_0x2102b0(0x75)]);}}),dom[_0x1d30b6(0x8e)]&&dom[_0x1d30b6(0x93)]&&(_0x56ac0f===_0x1d30b6(0x91)?(dom[_0x1d30b6(0x8e)][_0x1d30b6(0xa5)]=_0x1d30b6(0xd1),dom[_0x1d30b6(0x93)]['className']=_0x1d30b6(0x7f)):(dom[_0x1d30b6(0x93)][_0x1d30b6(0xa5)]=_0x1d30b6(0xd1),dom[_0x1d30b6(0x8e)][_0x1d30b6(0xa5)]=_0x1d30b6(0x7f)));}function a7_0x1f57(_0x20abeb,_0x58f709){_0x20abeb=_0x20abeb-0x74;const _0x4a9c02=a7_0x4a9c();let _0x1f5776=_0x4a9c02[_0x20abeb];return _0x1f5776;}function updateMapVisibility(){const _0x140f09=a7_0x1f57,_0x308161=state[_0x140f09(0x96)]['getZoom']();Object['keys'](state[_0x140f09(0xc2)])[_0x140f09(0x8d)](_0x46c3a6=>{const _0x45226a=_0x140f09,_0x1f3aa0=state[_0x45226a(0xc2)][_0x46c3a6],_0x4257cc=state[_0x45226a(0xb2)][_0x46c3a6];if(_0x308161>=ZOOM_THRESHOLD){if(_0x1f3aa0)_0x1f3aa0['getElement']()?.[_0x45226a(0x85)][_0x45226a(0xb0)]('hidden');if(_0x4257cc)_0x4257cc[_0x45226a(0xb4)]({'fillOpacity':POLYGON_OPACITY,'opacity':0x1});}else{if(_0x1f3aa0)_0x1f3aa0[_0x45226a(0x8b)]()?.[_0x45226a(0x85)][_0x45226a(0xc4)](_0x45226a(0xd9));if(_0x4257cc)_0x4257cc[_0x45226a(0xb4)]({'fillOpacity':0x0,'opacity':0x0});}});}export function handleMarkerClick(_0xd2f666,_0x5df7e7){const _0x17fbb8=a7_0x1f57;updateState(_0x17fbb8(0x9e),_0xd2f666),updateState(_0x17fbb8(0xd0),_0x5df7e7);if(dom['siteModalTitle'])dom['siteModalTitle'][_0x17fbb8(0xb8)]=_0xd2f666[_0x17fbb8(0xaa)];if(dom['siteModalLabel'])dom['siteModalLabel'][_0x17fbb8(0xb8)]=_0xd2f666['id'];if(dom[_0x17fbb8(0xc3)])dom['siteModalInfo'][_0x17fbb8(0xb8)]=_0xd2f666[_0x17fbb8(0xd4)];dom['siteModalImage']&&(dom['siteModalImage'][_0x17fbb8(0xd2)]=_0xd2f666[_0x17fbb8(0xb9)]||'https://placehold.co/600x400/eee/ccc?text=Heritage+Site',dom[_0x17fbb8(0xcd)][_0x17fbb8(0x85)][_0x17fbb8(0xb0)](_0x17fbb8(0x90)),dom[_0x17fbb8(0xcd)][_0x17fbb8(0xdb)]=()=>dom['siteModalImage'][_0x17fbb8(0x85)][_0x17fbb8(0xc4)](_0x17fbb8(0x90)));dom[_0x17fbb8(0xa6)]&&(dom[_0x17fbb8(0xa6)][_0x17fbb8(0xb8)]=_0xd2f666[_0x17fbb8(0xc6)]||'',dom[_0x17fbb8(0xa6)][_0x17fbb8(0x85)][_0x17fbb8(0xb0)](_0x17fbb8(0xd9)));if(dom[_0x17fbb8(0xaf)])dom[_0x17fbb8(0xaf)]['textContent']=_0x17fbb8(0xa8);setupSiteModalQuiz(_0xd2f666),animateOpenModal(dom[_0x17fbb8(0x82)]),openModalState(_0x17fbb8(0x82));}function setupSiteModalQuiz(_0x5b65da){const _0x417bb9=a7_0x1f57;if(!dom['siteModalQuizArea'])return;if(state['visitedSites'][_0x417bb9(0xbb)](_0x5b65da['id'])){dom[_0x417bb9(0xca)][_0x417bb9(0x85)][_0x417bb9(0xb0)](_0x417bb9(0xd9)),dom[_0x417bb9(0x8a)][_0x417bb9(0x85)][_0x417bb9(0xb0)](_0x417bb9(0xd9));return;}const _0x10630f=_0x5b65da[_0x417bb9(0xc5)];if(!_0x10630f||!_0x10630f['a']){dom[_0x417bb9(0xca)][_0x417bb9(0x85)][_0x417bb9(0xb0)](_0x417bb9(0xd9)),dom[_0x417bb9(0x8a)][_0x417bb9(0x85)]['remove'](_0x417bb9(0xd9));return;}dom[_0x417bb9(0xca)][_0x417bb9(0x85)][_0x417bb9(0xc4)]('hidden'),dom[_0x417bb9(0x8a)][_0x417bb9(0x85)]['add'](_0x417bb9(0xd9)),dom[_0x417bb9(0xb5)][_0x417bb9(0xb8)]=_0x10630f['q']||STRINGS[_0x417bb9(0xa7)][_0x417bb9(0x7b)],dom['siteModalQuizOptions'][_0x417bb9(0x9b)]='',dom[_0x417bb9(0x87)]['textContent']='';const _0x5b79c0=_0x10630f['options']||[];_0x5b79c0['forEach'](_0x36c6f2=>{const _0x520e52=_0x417bb9,_0x533d13=document[_0x520e52(0xab)](_0x520e52(0xd7));_0x533d13[_0x520e52(0xa5)]=_0x520e52(0x81),_0x533d13[_0x520e52(0xb8)]=_0x36c6f2,_0x533d13[_0x520e52(0x7c)]=async()=>{const _0x30bb84=_0x520e52,_0x51c1d7=await hashString(_0x36c6f2);_0x51c1d7===_0x10630f['a']?(dom[_0x30bb84(0x87)][_0x30bb84(0xb8)]='Correct!\x20ðŸŽ‰',dom[_0x30bb84(0x87)][_0x30bb84(0xa5)]=_0x30bb84(0xd6),dom[_0x30bb84(0x8a)][_0x30bb84(0x85)][_0x30bb84(0xc4)](_0x30bb84(0xd9)),dom[_0x30bb84(0xca)][_0x30bb84(0x85)][_0x30bb84(0xb0)](_0x30bb84(0x9a),'pointer-events-none')):(dom['siteModalQuizResult'][_0x30bb84(0xb8)]='Try\x20again!\x20ðŸ¤”',dom[_0x30bb84(0x87)]['className']=_0x30bb84(0xac));},dom[_0x520e52(0xdc)][_0x520e52(0xb7)](_0x533d13);});}export function showPreviewCard(_0x2e6693){const _0x1388cd=a7_0x1f57;if(!dom[_0x1388cd(0xa0)])return;updateState('currentPreviewSiteId',_0x2e6693['id']),dom['previewTitle'][_0x1388cd(0xb8)]=_0x2e6693['id']+'.\x20'+_0x2e6693['name'],dom[_0x1388cd(0x9f)][_0x1388cd(0xd2)]=_0x2e6693['image']||_0x1388cd(0x94),dom['previewCard']['classList'][_0x1388cd(0xc4)](_0x1388cd(0xd9),'preview-card-closing'),dom['previewCard'][_0x1388cd(0x85)]['add'](_0x1388cd(0x95));}export function closePreviewCard(){const _0x2498db=a7_0x1f57;if(!dom[_0x2498db(0xa0)]||dom[_0x2498db(0xa0)][_0x2498db(0x85)][_0x2498db(0x78)](_0x2498db(0xd9)))return;dom[_0x2498db(0xa0)][_0x2498db(0x85)]['remove'](_0x2498db(0x95)),dom[_0x2498db(0xa0)]['classList'][_0x2498db(0xb0)](_0x2498db(0xcb)),setTimeout(()=>{const _0x18ea04=_0x2498db;dom[_0x18ea04(0xa0)][_0x18ea04(0x85)][_0x18ea04(0xb0)](_0x18ea04(0xd9)),dom[_0x18ea04(0xa0)][_0x18ea04(0x85)][_0x18ea04(0xc4)]('preview-card-closing');},0x190);}